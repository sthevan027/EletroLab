import{d as e,a as t}from"./ai-engine-8WJZWTWf.js";function n(e,t=5){return e>=1e12*t?"0.99 OVRG":e<1e3?`${e.toFixed(0)}Ω`:e<1e6?`${(e/1e3).toFixed(2)}kΩ`:e<1e9?`${(e/1e6).toFixed(2)}MΩ`:e<1e12?`${(e/1e9).toFixed(2)}GΩ`:`${(e/1e12).toFixed(2)}TΩ`}function a(e){if(e.includes("OVRG"))return;const t=[{regex:/^(\d+)Ω$/,multiplier:1},{regex:/^(\d+\.\d{2})kΩ$/,multiplier:1e3},{regex:/^(\d+\.\d{2})MΩ$/,multiplier:1e6},{regex:/^(\d+\.\d{2})GΩ$/,multiplier:1e9},{regex:/^(\d+\.\d{2})TΩ$/,multiplier:1e12}];for(const n of t){const t=e.match(n.regex);if(t)return parseFloat(t[1])*n.multiplier}}function i(e){if(e.length<4)return"Undefined";const t=a(e[1].resistance),n=a(e[3].resistance);if(void 0===t||void 0===n||0===t)return"Undefined";return(n/t).toFixed(2)}async function r(n){return await async function(n){const{category:r,kv:o=1,limitTOhm:s=5,tag:m,client:c,site:p,operator:d,manufacturer:u,model:g}=n,h=await e.getAILearningHistory(r),f={category:r,historicalData:h.map(e=>e.output?JSON.parse(e.output).readings?.map(e=>a(e.resistance)||0):[]).filter(e=>e.length>0),environmentalFactors:{temperature:20+15*Math.random(),humidity:45+25*Math.random(),pressure:1013+20*(Math.random()-.5)},equipmentAge:Math.floor(15*Math.random()),maintenanceHistory:[],manufacturer:u,model:g},l=await t.generateIRReport(f),y=i(l.readings);return await e.recordAILearning({id:Date.now(),category:r,phaseCount:1,phaseNames:["single"],input:JSON.stringify(f),output:JSON.stringify(l),createdAt:(new Date).toISOString()}),{readings:l.readings,dai:y,confidence:l.confidence,insights:l.insights,warnings:l.warnings,recommendations:l.recommendations}}(n)}async function o(r,o){const p=[],d=r.phases.names,u=await e.getAILearningHistory(r.equipmentType),g={category:r.equipmentType,historicalData:u.map(e=>e.output?JSON.parse(e.output).readings?.map(e=>a(e.resistance)||0):[]).filter(e=>e.length>0),environmentalFactors:{temperature:20+15*Math.random(),humidity:45+25*Math.random(),pressure:1013+20*(Math.random()-.5)},equipmentAge:Math.floor(15*Math.random()),maintenanceHistory:[],manufacturer:void 0,model:void 0},h=await t.generateIRReport(g),f=d.map(()=>{const e=h.readings.map(e=>a(e.resistance)||0);return e[Math.floor(Math.random()*e.length)]}),l=[],y=[],v=["00:15","00:30","00:45","01:00"],w=await e.getCategoryProfile(r.equipmentType)||($=r.equipmentType,{id:crypto.randomUUID(),category:$,name:`Perfil ${$}`,description:`Perfil padrão para ${$}`,baseResistance:{min:1e6,max:1e7,decay:.95},temperature:{min:20,max:25,effect:.02},humidity:{min:50,max:60,effect:.01},aiConfidence:.7,createdAt:new Date,updatedAt:new Date});var $;o.phaseCombinations.forEach((e,t)=>{const a=d.indexOf(e[0]),r=d.indexOf(e[1]);if(-1!==a&&-1!==r){const o=(f[a]+f[r])/2,p=[];v.forEach(e=>{const a=c(e);let i=s(o,a,.95);const r=g.environmentalFactors.temperature,d=g.environmentalFactors.humidity;i=m(i,r,d,w);i*=1+(Math.random()-.5)*(1-h.confidence)*.2,l.push({phase:t,time:e,resistance:n(i),temperature:r,humidity:d}),p.push({time:e,kv:"1.00",resistance:n(i)})});const d=i(p.map(e=>({time:e.time,kv:e.kv,resistance:e.resistance})));y.push({id:`PP-${e[0]}-${e[1]}`,testNo:t+1,type:"phase-phase",description:`${e[0]} × ${e[1]}`,phases:[e[0],e[1]],readings:p,dai:d,comments:""})}}),d.forEach((e,t)=>{const a=.8*f[t],r=[];v.forEach(e=>{const i=c(e);let o=s(a,i,.95);const p=g.environmentalFactors.temperature,u=g.environmentalFactors.humidity;o=m(o,p,u,w);o*=1+(Math.random()-.5)*(1-h.confidence)*.3,l.push({phase:d.length+t,time:e,resistance:n(o),temperature:p,humidity:u}),r.push({time:e,kv:"1.00",resistance:n(o)})});const p=i(r.map(e=>({time:e.time,kv:e.kv,resistance:e.resistance})));y.push({id:`PG-${e}-${o.groundName}`,testNo:o.phaseCombinations.length+t+1,type:"phase-ground",description:`${e} × ${o.groundName}`,phases:[e,o.groundName],readings:r,dai:p,comments:""})});let x=h.confidence;const M=l.filter(e=>e.phase<o.phaseCombinations.length),N=l.filter(e=>e.phase>=o.phaseCombinations.length);M.length<N.length&&(p.push("Valores fase/fase parecem inconsistentes com fase/massa"),x*=.9),p.push(...h.warnings);const q={id:crypto.randomUUID(),configId:r.id,equipmentTag:o.equipmentTag,operator:o.operator,readings:l,reports:y,summary:{phaseCount:d.length,averageResistance:f.reduce((e,t)=>e+t)/f.length,status:"Completo"},equipment:{tag:o.equipmentTag,category:r.equipmentType},createdAt:new Date,isSaved:!1};return await e.recordAILearning({id:Date.now(),category:r.equipmentType,phaseCount:d.length,phaseNames:d,input:JSON.stringify({equipmentType:r.equipmentType,voltage:r.voltage,phaseNames:d,combinations:o.phaseCombinations}),output:JSON.stringify({report:q,confidence:x,warnings:p}),createdAt:(new Date).toISOString()}),{report:q,confidence:x,warnings:p,insights:h.insights,recommendations:h.recommendations}}function s(e,t,n){const a=Math.log(n)/60;return e*Math.exp(a*t)}function m(e,t,n,a){return e*(1+(t-25)*a.temperature.effect*-.01)*(1+(n-50)*a.humidity.effect*-.01)}function c(e){const[t,n]=e.split(":").map(Number);return 60*t+n}export{o as a,r as g};
